---
sidebar_position: 1
---

# Litepaper

---

## Introduction


Ithil is a **generalised leveraged investments protocol** allowing liquidity providers to stake any ERC20 token and earn fees in that same  (eg. stake DAI get more DAI, put SHIBA get more SHIBA) and to traders to use the available liquidity to run investments with a higher capital than their initial one (i.e. *a leverage*). This is possible thanks to internal **undercollateralised loans** where the protocol *Vault* makes its liquidity available to the traders to run investment *strategies*, which will eventually repay the loan and deliver the profits, if any, to the trader. In order to use the vault's liquidity, the trader needs to pay a **margin** to the desired investment strategy: it will cover eventual losses, but it is given back to the trader in full in case of a profitable investment. When the value of an investment falls behind some critical threshold, external **liquidator bots** can forcefully close the position, getting a reward by doing so. 
The vault's liquidity is given by **liquidity providers**, which stake any ERC20 token in the vault and earn the fees generated by the investment process. **Governance token** holders can stake their tokens to perform decentralised liquidation and get rewards in the vault's tokens and can cast their vote in the DAO. A simple and solid backing system mathematically insures the dollar value of the governance token can only increase and never go below a certain floor, thus privileging holders committing to Ithil's community for a long time.

When the value of an investment falls behind some critical threshold, external **liquidators** can close the position forcefully, getting rewards by doing so. The vault's liquidity is given by **liquidity providers**, which stake any ERC20 token in the vault and earn the fees generated by the investment process.

## Leveraged investments

With Ithil, anyone can profit from a wide variety of DeFi market scenarios by performing leveraged investments; the seamless workflow allows the trader to enter into any investment strategy with few clicks, letting Ithil deal with all the complex procedures necessary to implement a particular strategy.
A *true* leverage is made possible by an internal system of uncollateralised loans, in which the funds are borrowed from Ithil's liquidity vault to be invested and the result of the particular investment is *locked* in the strategy contract.
In order for a user to be able to perform a leveraged investment via a selected strategy, there must be some *margin* posted into the strategy smart contract; this is necessary to cover for potential losses the vault could incur in the case of an unfavorable market movement.

![Borrowing process](/img/core/borrow-process.png)

The opening of a position is done in three steps:
- The user posts some margin into the strategy and sets the desired investment parameters
- The strategy borrows funds from the vault, if the desired investment is higher than the margin posted
- The strategy performs all the internal and external calls to get *assets* which are then locked into the strategy itself.

Since the amount invested might be higher than the user's initial capital, the investment can be *leveraged*: in this way, the assets obtained will have a much higher value than if the user directly buys them from an external protocol.

![Repayment process](/img/core/repay-process.png)

The closure of a position is likewise done in three steps:
- The assets are exchanged internally or through an external DeFi protocol, to obtain the initial token used for the investment
- The strategy repays the loan taken from the vault, plus interest rates and fees
- The remaining part of the payoff is given back to the trader.

The strategies which can be implemented are in principle very general: Ithil's community can implement a new strategy at any time and the governance can approve it to use the vault's funds.

![Strategy approval process](/img/strategies/strategy-approval-process.png)

In order to prevent the governance to take faulty decisions which would put the protocol's liquidity at risk, all strategies must inherit from a common **base strategy**, an *abstract* contract which implements the borrow and repay logic agnostically from the particular investment logic. Such measure has the double advantage of setting a precise standard to assure the vault's liquidity is protected and to make the development of new strategies much simpler and faster.

![Base strategy](/img/core/strategies.png)

Besides calling the relevant external contracts to perform the particular investment, the specific strategies must also implement a **quoter**, a view function which gives at every time the value of the obtained assets with respect to the initial token used to obtain them. This is important for liquidations and for margins given in the asset token.

Since the liquidity transferred from the vault and locked in the form of assets in the strategies belongs to the LPs, every time a loan is taken the vault computes the **interest rate** at which the liquidity can be borrowed for that particular investment. The calculation of the interest rate takes into account the riskiness of the investment, the amount of liquidity taken and the amount of margin posted by the user.

We give here two examples of simple strategies, while ideally **the strategies that can be implemented are potentially infinite and can vary in complexity and risk, covering pure DeFi to more structured TradFi-like ones**.

### Margin trading

Margin trading is the simplest form of a strategy, in which the investment logic is exchanging one token for another one on an external exchange platform.

![Margin trading strategy](/img/strategies/margin-trading.png)

The strategy's quoter will keep track of the exchange rate of Token A with respect to Token B. When the position is closed, Token B is exchanged to obtain back Token A: the quantity of Token A obtained will determine if the investment has been profitable or not.
Let us make a numerical example of a **long position**:
- A user posts a margin of 100 TKA to the Margin Trading Strategy (MTS) contract and decides to go *long* with a x10 leverage on TKB.
- Assuming an exchange rate of 50 TKA/TKB, the MTS will then borrow 900 TKA from the vault, say at a daily interest rate of 0.1% and exchange 1000 TKA to obtain 20 TKB from an external protocol. This tokens are locked in the MTS and an onchain position is opened for the user.
- If the user closes the position after 10 days, when the exchange rate has increased by 20% to 60 TKA/TKB, then exchanging 20 TKB back will provide 1200 TKA to the MTS. 
- The MTS will repay the 909 TKA to the vault (900 borrowed plus 1% interest) and deliver the remaining 291 TKA to the user. With a market movement of only 20%, the user has realised a whopping 191% gain thanks to the 10x leverage.

In the case of a **short position** the situation is similar:
- A user posts a margin of 100 TKA to the MTS contract and decides to go *short* with a x10 leverage on TKB.
- Assuming an exchange rate of 50 TKA/TKB, the MTS will then borrow 20 TKB from the vault, say at a daily interest rate of 0.1% and exchange them on an external protocol to obtain 1000 TKA. This tokens are locked in the MTS and an onchain position is opened for the user. At this point, 1100 TKA are locked in the MTS.
- If the user closes the position after 10 days, when the exchange rate has decreased by 20% to 40 TKA/TKB, then only 808 TKA are necessary to obtain the 20.2 TKB back to repay the vault (20 borrowed plus 1% interest). 
- The remaining 292 TKA are delivered to the user. A market movement of only 20% has made the trader earn 192% thanks to the 10x leverage.

In both cases, the user can post the margin either in TKA or TKB and the MTS will adjust the amount of the loan to take from the vault accordingly.
Of course, if the market moves unfavorably, the losses are equally aplified with respect of a non-leveraged trade. If the exchange falls below some critical level, the position will be liquidated.

### Leveraged staking

Through the Leveraged Staking Strategy (LSS), the vault's liquidity can be borrowed and staked on an external protocol to get a leveraged yield. If the yield obtained from the staking protocol is higher than the interest rate necessary to borrow the funds, the difference represents the gain of the user.

![Leveraged staking strategy](/img/strategies/leveraged-staking.png)

Let us make a numerical example.
- A user posts a margin of 100 TKA to the LSS contract and decides to stake TKA on an external staking protocol SP with a 10x leverage.
- The LSS contract will borrow 900 TKA from the vault and stake the 1000 TKA on SP, obtaining say 1000 lTKA, the wrapped tokens representing the stake.
- Assume that, after one month, the rolling APR of SP hah been 60%, thus giving a monthly gain of 5%. Assume also that the monthly interest rate applied by Ithil's vault has been 3%. 
- If the user closes its position, the 1000 lTKA will be redeemed on SP to obtain 1050 TKA, while the vault has to be repaied of 927 TKA (900 TKA borrowed, plus 3%). The remaining 123 TKA are given back to the user, which will see a 23% gain in one month using a staking protocol which has only given 5% of yield. This is possible thanks to the x10 leverage.


In both cases, the user can post the margin either in TKA or lTKA and the MTS will adjust the amount of the loan to take from the vault accordingly.
Of course, if the price per share increases less than the applied interest rate, the user may lose money. If the interest accrued go above some critical level, the position will be liquidated.

## Undercollateralized loans

In order to allow the users to perform leveraged investments, Ithil adopts a system of **internal undercollateralized loans**, in which the amount internally transferred from the vault to the strategy is higher than the margin posted by the user. This is possible because the assets resulting from this loan are locked into the strategy: they do not go outside Ithil's contracts.

### Ithil's vault and fees

The lending contract is the **vault**, into which **liquidity providers** can stake their tokens and get the fees and interest generated by the investments. The list of supported, or **whitelisted** tokens is managed by the governance following security and market criteria. All whitelisted tokens can be staked in the vault, thus making Ithil a good choice to get APY *in virtually any token*.

![LP tokens](/img/core/lp-tokens.png)

The liquidity given to the strategy in the form of loans is protected by the user's margin and by **liquidators**, which close the positions whose margin has been eroded by more than a strategy-specific **risk factor**, and get rewarded for this. Since, due to very unfavorable market conditions, liquidators may fail to properly liquidate a given position, the vault's liquidity is further protected via the **insurance reserve**: governance-owned liquidity which is used to restore a liquidity loss due to a bad liquidation. The amount of the insurance reserve is adjusted *algorithmically* to insure good capital protection and at the same time a competitive interest rate for liquidity providers.

When a loan is taken from a strategy, the vaults computes the interest rate at which the loan is taken. This is calculated taking several factors into account:
- The riskiness of an investment, captured in a number called **risk factor**. 
- The **usage**, which is the amount of open loans with respect to the vault's free liquidity.
- The **uninsured portion** of the vault, which is the percentage of the vault's balance which is not insurance reserve.
- The **collateralization** of the position, which is the ratio between the borrowed amount and the margin (denominated in borrowed tokens).
The final interest rate is then directly proportional to these four numbers, i.e. it's the multiplication of all of them renormalized by a global factor. The interest rate is computed considering the vault state at the opening of a position, while the due fees are calculated at the closure of the same position.

Finally, a small fixed fee is set by the governance and it is charged as a percentage of the borrowed amount, regardless of the duration of the position. This reduces the economic rationale of potential attacks in which positions are open and closed immediately.

Since taking a loan when the vault is almost totally used is extremely costly, this formula assures that there will likely be some amount of free liquidity which can be *redeemed* at any time by liquidity providers. If all free liquidity has been withdrawn by LPs, as some positions are closed it will be costly to open new ones, thus again assuring, after a short period of time, the availability of further liquidity to support withdrawals, in a positive feedback cycle.

When a position is closed and fees are paid to the vault, a portion of them go to the insurance reserve. This portion is algorithmically computed to make the insurance reserve ratio converge towards an **optimal ratio**: at the optimal ratio, the fees going to the insurance reserve are at a minimum, and the governance has the right of redeeming the excess insurance reserve (but not beyond the optimal ratio).

### LP tokens

In order to assure a fair and gas-efficient fees distribution method, Ithils adopts the classical method of LP tokens, which are minted to liquidity providers in a quantity reflecting the *share price* of the given LP token. The **total wealth** of the vault is the quantity of tokens deposited in total by liquidity providers, plus all fees generated and not claimed. This can be calculated as the total balance excluding governance-owned liquidity, plus the open loans. When a liquidity provider deposits some amount of TKA, then some amount of LP tokens iTKA will be minted, calculated as follows.

![Staking](/img/core/staking.png)

Similarly, an holder of iTKA can burn at any time its tokens, thus receiving a transfer of TKA calculated as follows.

![Unstaking](/img/core/unstaking.png)

The factor of the burned amount in the previous formula is the **share price** of the LP token considered.
In this way, a liquidity provider trying to deposit and withdraw immediately some funds, will receive exactly the same amount deposited, and only the fees generated *after* the deposit will contribute to the provider's APY: no arbitrage is possible. Moreover, a simple calculation shows that neither deposits nor withdrawals change the share price, thus the effect of a liquidity provider withdrawing or deposit is not seen by others.

## Liquidations

Liquidations are a fundamental part in the echosystem: closing positions getting too close to having their margin completely eroded (more precisely, beyond a strategy-specific percentage called the **risk factor**), they protect the vault's liquidity and prevent the share price of LP tokens to decrease. In this way, liquidity providers are guaranteed to receive a positive APY with a very low risk.

Ithil's liquidation system is completely decentralised and onchain: anyone which holds a sufficient amount of Ithil's governance token can launch Ithil's liquidation functions which will check onchain, using the *quoter* function of the particular strategy, if a given position is liquidable. Liquidators can close one or more positions in one go, thus saving gas and performing a faster liquidation. Once a position is liquidated, the part of the margin which is not eroded is transferred in full to the liquidator: in this way, a faster liquidation will assure the liquidator a higher reward. If the margin is not sufficient to reward the liquidator, we consider this a **bad liquidation**: in this case, a part of the insurance reserve is used to restore the eventual liquidity loss and to compensate the liquidator.

Liquidation is therefore a profitable activity: the best liquidator will have fast and precise bots which quickly identify liquidable positions and launch the liquidation process. Precision is important because, if a liquidator tries to close a non-liquidable position, the liquidation does not take place and the gas is lost.+

There are three possible liquidations to be performed on Ithil.
- **Closing positions**: the liquidator closes one or more positions in behalf of the users, getting the users' margins or part of the insurance reserve if this is not enough. This is the most gas-intensive and risky (closing big positions can have a large market impact, thus reducing the reward), but the potential gains are higher.
- **Margin calls**: the liquidator tops up the position's margin and becomes the owner of the position. This is the cheapest and less gas-intensive form of liquidation, moreover in this way the liquidator can enter the same investment as the previous user, thus if market moves favorably an easy gain can be done. However, the risk for the liquidator is to be in turn liquidated if the market moves unfavorably.
- **Total cover**: the liquidator repays the loan and the fees to the vault and receives the assets locked in the strategy in her or his wallet. This stands in the middle in terms of gas and leaves to the liquidator the choice to arbitrage by immediately selling the received assets, or keeping them for another purpose.

In order to liquidate, liquidators need to stake their Ithil's governance tokens in the liquidation contract: when a good amount of liquidations have been performed, such governance tokens can be withdrawn.

## Governance token

Governance tokens ITH are vital for Ithil's growth and sustainability. Ithil's governance token holders participate in governance decisions, perform liquidations and earn from them and get rewards in the form of an ever-increasing backing system coming from all these activities.

### Liquidations

When Ithil tokens are staked in the liquidation contract, the staker can perform liquidation and earn in a way described in the liquidation section. The amount to be liquidated in a single call increases with the amount of ITH staked. As the liquidated amount increases, the ITH staked are gradually "unblocked" until all ITH can be unstaked from the liquidation contract, together with the earnings from the liquidation activity.

### Rewards

ITH is backed in a specific backing contract similar to Ithil's vault. The price per share calculated by the contract is so that every circulating (i.e. outside the backing contract) ITH can be redeemed at any moment at that price, thus assuring the rewards accumulated by ITH holders are distributed. Moreover, redeeming ITH on the backing contract does not change the price, as it can be seen by a direct calculation.

![Backing](/img/token/backing.png)

The stablecoins inside the backing contract can come from various sources, such as
- Excess insurance reserve above the optimal ratio.
- Direct ITH exchange on the backing contract.
- Profits from separate treasury's investments.

The key takeaway is the fact that *there is no way to extract stablecoins from the backing contract, except redeeming ITH*. In this way, the backing price of ITH can never decrease, while there are various ways in which it can increase. A ITH holder will then see the backing price of ITH always go up in time, a system which strongly encourages to commit to the community for a long time.

## Ithil's DAO

Ithil will progressively become a DAO - decentralised autonomous organisation. Core decisions will be taken by token holders, collectively referred as *governance*, with a thriving community of traders, LPs as well as people who put in work for the advancement of the protocol itself. As a reward, these contributors will be paid in governance tokens taken from Ithil's treasury. We foresee onboard designers, developers, financial experts, traders and marketers to work on several different side-projects and spin-offs like adding new strategies. Thanks to the community, the protocol will constantly enrich with new strategies by using community inputs as a way to democratise and distribute the development and progress of Ithil itself.
A non-exhaustive list of possible governance-based decisions is:
- Listing or de-listing of a token or a strategy.
- Assess the risk factor of a particular token within a strategy.
- Boost or damp one stablecoin's APY using the treasury's liquidity.
- Initiate and manage liquidity mining activities.
Each time, an ITH token holder can stake his or her tokens and participate in the voting, proportionately to the number of tokens owned and staked.

### The treasury

All Ithil's decisions and community building cannot take place without a solid treasury. Ithil's treasury is entirely made of ITH tokens, which will be used for various important tasks such as the following.
- Pay for community mining and marketing activities.
- Allowing APY boosts for particular vaults.
- Investing in airdrops and external activities.
Each time, the DAO will propose and let all ITH holders decide about Ithil's resolution.

## Conclusions

With Ithil, we bring a new generation experience of DeFi investments, thanks to undercollateralised loans and an unmatched protection and growth system. Thanks to the leverage, all users can earn high profits only from their own market insights, even if their initial wealth is not high. Liquidations and fair distribution make Ithil attractive also for stakers willing to have a slow and steady return on *any* token (a rare possibility in the DeFi world), while a solid tokenomics and a mathematically increasing backing will make investing in ITH a no-brainer.

### Key takeaways
* Internal undercollateralised leverage system
* Trade any ERC20 token, including meme/gaming tokens and fractionalised NFTs
* Fully on-chain, can be integrated in other protocols
* Gas optimisation and liquidity aggregation via multi-chain routing
* Efficient liquidation via a network of bots that anyone can run
* Several strategies to choose from, with different risk and reward levels

### Why is Ithil different from other protocols on the market
* **Cross-chain** diversified portfolio of popular DeFi **strategies**.
* **Undercollateralised leverage** to boost your profits.
* The protocol is chain-independent, you can execute a strategy on Polygon while having your assets on Ethereum mainnet
* Liquidity providers get **rewarded with their favourite token**, thus allowing them to stake virtually any crypto asset (supported by Ithil). Usually, other protocols reward liquidity providers with governance tokens.
* Flexible trading experience with (almost) **any type of token allowed as margin**, sophisticated charts and good market rates will attract more traders to us. Typical margin trading platforms are hard to use, gas intensive and ultimately unattractive or just support a handful of tokens.
* The **governance token will be inflationary**: backed by the protocol earnings and giving opportunity to earn even more by providing support to the platform.

## Who is behind it
The idea started when three developers with diverse backgrounds met during a hackathon. In our discussions, it was clear that the DeFi world lacked a consistent way to provide liquidity and earn income in the same token staked and that the existing protocols are so rigid in nature, that they struggle to keep pace with the fast growing DeFi world. At the same time, most traders were struggling to find easy ways to execute repetitive strategies on multiple chains. 
We iterated on that, took some ideas from traditional finance and translated them into crypto language: our goal was initially to create a platform which only allowed margin trading, but we then realised that our project had much bigger potential since the earning system of the vault (the core of our protocol) is agnostic of the investment activity. Now that the core is robust and well-refined, we are heading to creating the largest diversified investment platform available in the market.
We prefer to stay anonymous as want the project and its DAO to be the real and public facade and by being anon the team can totally focus on providing value to the community.

### How can I get in touch with you
We are available on Discord or Twitter, ping us there and we will be happy to answer!